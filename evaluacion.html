<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jornada de Formaci√≥n Salesiana: De la Visi√≥n a la Evidencia</title>
    <meta name="description" content="P√°gina interactiva para la Jornada de Formaci√≥n Salesiana sobre evaluaci√≥n educativa, dise√±ada para guiar a los docentes a trav√©s de un proceso formativo, justo y con prop√≥sito.">
    <meta name="keywords" content="evaluaci√≥n, formaci√≥n docente, salesianos, Bolivia, pedagog√≠a, Don Bosco, taller, educaci√≥n">
    <meta name="author" content="Asesor Pedag√≥gico Salesiano">
    <meta property="og:title" content="Jornada de Formaci√≥n Salesiana: De la Visi√≥n a la Evidencia">
    <meta property="og:description" content="Una experiencia de aprendizaje interactiva sobre evaluaci√≥n formativa.">
    <meta property="og:image" content="https://sdb.bo/sdb/wp-content/uploads/2021/12/SALECIANOS-VERTICAL-2.png">
    <meta property="og:url" content="https://elmejorequipo.github.io/talleres/evaluacion.html">
    <meta property="og:type" content="website">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');
        :root{--prm:#005A9C;--sec:#FFC72C;--bg:#f4f7fa;--txt:#333;--wht:#fff;--shw:0 4px 15px rgba(0,0,0,0.08);--corr:#28a745;--err:#dc3545}
        body{font-family:'Poppins',sans-serif;background-color:var(--bg);color:var(--txt);line-height:1.6;margin:0;padding:20px}
        .container{max-width:900px;margin:0 auto;background-color:var(--wht);border-radius:15px;box-shadow:var(--shw);overflow:hidden}
        header{background-color:var(--prm);color:var(--wht);padding:30px 20px;text-align:center;position:relative}
        header h1{margin:0 0 10px 0;font-size:2.5rem;font-weight:700}
        header h2{margin:0;font-size:1.8rem;font-weight:600;opacity:0.95}
        header p{margin:10px 0 0;font-size:1.1rem;opacity:0.9}
        .logo-salesianos{position:absolute;top:20px;left:25px;height:80px;opacity:0.9}
        main{padding:20px}
        .progress-container{margin-bottom:30px}
        .progress-bar-wrapper{width:100%;background-color:#e0e0e0;border-radius:50px;overflow:hidden}
        .progress-bar{height:20px;width:0%;background-color:var(--sec);border-radius:50px;transition:width .5s ease-in-out;text-align:center;color:var(--txt);font-weight:600}
        .progress-label{text-align:center;font-weight:600;color:var(--prm);margin-top:5px}
        .phase-accordion details{margin-bottom:15px;border-radius:10px;border:1px solid #ddd;overflow:hidden}
        .phase-accordion summary{background-color:var(--wht);color:var(--prm);font-size:1.3rem;font-weight:600;padding:15px 20px;cursor:pointer;list-style:none;display:flex;justify-content:space-between;align-items:center;transition:background-color .3s}
        .phase-accordion details[open] summary{background-color:var(--prm);color:var(--wht)}
        .phase-accordion summary::after{content:'‚ûï';font-size:1.5rem;transition:transform .3s ease-out}
        .phase-accordion details[open] summary::after{content:'‚ûñ';transform:rotate(180deg)}
        .activities-container{padding:20px;background-color:var(--bg);display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px}
        .activity-card{background-color:var(--wht);border-radius:10px;padding:20px;box-shadow:0 2px 8px rgba(0,0,0,.08);border-left:5px solid var(--sec);display:flex;flex-direction:column;justify-content:space-between}
        .activity-card h3{margin-top:0;color:var(--prm);font-size:1.1rem}
        .task-completion{margin-top:15px;padding-top:15px;border-top:1px solid #eee}
        .lock-container{display:flex;gap:10px;align-items:center;margin-bottom:10px}
        .lock-container input{padding:8px;border:1px solid #ccc;border-radius:4px;flex-grow:1}
        .lock-container button{padding:8px 12px;border:none;background:var(--prm);color:var(--wht);border-radius:4px;cursor:pointer}
        .task-feedback{font-size:0.8em;margin-top:5px;font-weight:600}
        .task-checkbox-wrapper{display:flex;align-items:center;cursor:pointer;opacity:1}
        .task-checkbox-wrapper.locked{opacity:0.5;cursor:not-allowed}
        .task-checkbox-wrapper input[type=checkbox]{width:20px;height:20px;margin-right:10px;cursor:pointer}
        .task-checkbox-wrapper input[type=checkbox]:disabled{cursor:not-allowed}
        .task-checkbox-wrapper label{font-weight:600;color:var(--prm);cursor:pointer}
        .resource-buttons{margin-top:15px;display:flex;flex-direction:column;gap:10px}
        .btn-resource{font-weight:600;text-decoration:none;display:inline-block;padding:8px 15px;border-radius:5px;text-align:center}
        .btn-activity{background-color:var(--sec);color:var(--txt)}
        .commitment-form .form-group{margin-bottom:15px}
        .commitment-form label{display:block;margin-bottom:5px;font-weight:600}
        .commitment-form input,.commitment-form select{width:100%;padding:8px;border:1px solid #ccc;border-radius:4px;box-sizing:border-box}
        .modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.6);display:flex;align-items:center;justify-content:center;z-index:1000;padding:20px;box-sizing:border-box;opacity:0;visibility:hidden;transition:opacity .3s, visibility .3s}
        .modal.visible{opacity:1;visibility:visible}
        .modal-content{background:var(--wht);padding:30px;border-radius:15px;box-shadow:0 5px 25px rgba(0,0,0,.2);width:100%;max-width:500px;text-align:center;transform:scale(.9);transition:transform .3s}
        .modal.visible .modal-content{transform:scale(1)}
        .modal-content h2{color:var(--prm)}
        .modal-content .data-confirm p{background:#eee;padding:10px;border-radius:5px;text-align:left}
        .modal-content .modal-buttons{display:flex;justify-content:space-around;margin-top:20px}
        .modal-buttons button{padding:10px 20px;border-radius:8px;border:none;font-size:1rem;font-weight:600;cursor:pointer}
        #welcome-modal-btn, #confirm-download-btn{background:var(--corr);color:var(--wht); padding: 15px 30px; font-size: 1.2rem; box-shadow: 0 4px 10px rgba(40,167,69,0.4);}
        #edit-data-btn{background:#6c757d;color:var(--wht)}
        .ad-section{padding:30px 20px;text-align:center;background-color:#e9ecef}
        .ad-section h2{color:var(--prm)}
        .ad-container{display:flex;flex-wrap:wrap;justify-content:center;gap:20px}
        .ad-card{background:var(--wht);border-radius:12px;box-shadow:var(--shw);width:300px;padding:20px;text-align:center}
        .ad-card h3{color:var(--prm)}
        .ad-card a{margin-top:15px;background:var(--prm);color:var(--wht);text-decoration:none;padding:10px 20px;border-radius:50px;display:inline-block}
        footer{text-align:center;padding:25px 0;margin-top:0;background-color:#e9ecef}
    </style>
</head>
<body>
    <div id="welcome-modal" class="modal">
        <div class="modal-content">
            <h2>¬°Bienvenido/a a la Jornada de Formaci√≥n!</h2>
            <p>Est√°s a punto de iniciar una experiencia de aprendizaje interactiva sobre la evaluaci√≥n. Tu misi√≥n es completar todas las tareas para obtener tu certificado.</p>
            <h4>¬øC√≥mo funciona?</h4>
            <ol style="text-align: left;">
                <li>Explora cada misi√≥n en orden. La primera tarea no necesita c√≥digo.</li>
                <li>Accede a los recursos (presentaciones, juegos, etc.).</li>
                <li>En cada recurso, encontrar√°s un <strong>c√≥digo secreto de 5 d√≠gitos</strong>.</li>
                <li>Introduce ese c√≥digo para desbloquear la tarea correspondiente.</li>
                <li>Al completar todas las tareas, podr√°s registrar tu compromiso y descargar tu certificado.</li>
            </ol>
            <button id="welcome-modal-btn">¬°Entendido, a comenzar!</button>
        </div>
    </div>

    <div class="container">
        <header>
            <img src="https://sdb.bo/sdb/wp-content/uploads/2021/12/SALECIANOS-VERTICAL-2.png" alt="Logo Salesianos" class="logo-salesianos">
            <h1>Jornada de Formaci√≥n Salesiana</h1>
            <h2>De la Visi√≥n a la Evidencia</h2>
            <p>El Camino del Evaluador Razonable y Amable</p>
        </header>
        <main>
            <div class="progress-container">
                <div class="progress-label" id="progress-text">Progreso del Taller: 0%</div>
                <div class="progress-bar-wrapper"><div class="progress-bar" id="progress-bar"></div></div>
            </div>
            <div class="phase-accordion">
                <details open>
                    <summary>Misi√≥n 1: Conectar y Activar</summary>
                    <div class="activities-container">
                        <div class="activity-card">
                            <div><h3>Bienvenida e Impacto Inicial</h3><p>Captamos la atenci√≥n con un mensaje potente.</p></div>
                            <div class="resource-buttons"><a href="https://gamma.app/docs/La-Evaluacion-yvjhqvklt7jkzrp" target="_blank" class="btn-resource btn-activity">Acceder al Recurso ‚Üó</a></div>
                            <div class="task-completion" data-task-id="task1">
                                <div class="task-checkbox-wrapper"><input type="checkbox" id="task1" class="task-checkbox"><label for="task1">Marcar como completada</label></div>
                            </div>
                        </div>
                        <div class="activity-card">
                            <div><h3>Trivia: Falso o Verdadero</h3><p>Activamos conocimientos previos con un juego.</p></div>
                            <div class="resource-buttons"><a href="https://elmejorequipo.github.io/talleres/trivia.html" target="_blank" class="btn-resource btn-activity">Acceder al Recurso ‚Üó</a></div>
                            <div class="task-completion" data-task-id="task2">
                                <div class="lock-container"><input type="text" placeholder="C√≥digo de la Tarea"><button>Desbloquear</button></div>
                                <div class="task-checkbox-wrapper locked"><input type="checkbox" id="task2" class="task-checkbox" disabled><label for="task2">Marcar como completada</label></div>
                                <p class="task-feedback" style="color:#777;">Anota el c√≥digo del recurso para desbloquear.</p>
                            </div>
                        </div>
                    </div>
                </details>
                <details>
                    <summary>Misi√≥n 2: Trazar el Mapa</summary>
                    <div class="activities-container">
                        <div class="activity-card">
                            <div><h3>El "Norte": Perfil de Salida</h3><p>Comprendemos por qu√© el Perfil de Salida es nuestra gu√≠a.</p></div>
                            <div class="resource-buttons"><a href="https://gamma.app/docs/El-Norte-es-el-Perfil-de-Salida-gd82doc127hk7wk" target="_blank" class="btn-resource btn-activity">Acceder al Recurso ‚Üó</a></div>
                             <div class="task-completion" data-task-id="task3">
                                <div class="lock-container"><input type="text" placeholder="C√≥digo de la Tarea"><button>Desbloquear</button></div>
                                <div class="task-checkbox-wrapper locked"><input type="checkbox" id="task3" class="task-checkbox" disabled><label for="task3">Marcar como completada</label></div>
                                <p class="task-feedback" style="color:#777;">Anota el c√≥digo del recurso para desbloquear.</p>
                            </div>
                        </div>
                        <div class="activity-card">
                            <div><h3>Del Perfil al Criterio</h3><p>"Traducimos" la visi√≥n en metas observables.</p></div>
                            <div class="resource-buttons"><a href="https://elmejorequipo.github.io/talleres/conecta.html" target="_blank" class="btn-resource btn-activity">Acceder al Recurso ‚Üó</a></div>
                             <div class="task-completion" data-task-id="task4">
                                <div class="lock-container"><input type="text" placeholder="C√≥digo de la Tarea"><button>Desbloquear</button></div>
                                <div class="task-checkbox-wrapper locked"><input type="checkbox" id="task4" class="task-checkbox" disabled><label for="task4">Marcar como completada</label></div>
                                <p class="task-feedback" style="color:#777;">Anota el c√≥digo del recurso para desbloquear.</p>
                            </div>
                        </div>
                         <div class="activity-card">
                            <div><h3>El ADN: Indicadores</h3><p>Creamos la evidencia concreta del aprendizaje.</p></div>
                            <div class="resource-buttons"><a href="https://character.ai/chat/0kYN93wDwulJnLuLZQIhgKKI0-mDvGegL23Bh-oG4kQ" target="_blank" class="btn-resource btn-activity">Acceder al Recurso ‚Üó</a></div>
                             <div class="task-completion" data-task-id="task5">
                                <div class="task-checkbox-wrapper locked"><input type="checkbox" id="task5" class="task-checkbox" disabled><label for="task5">Marcar como completada</label></div>
                                <p class="task-feedback" style="color:#777;">Se habilita al completar las tareas anteriores de la Misi√≥n 2.</p>
                            </div>
                        </div>
                    </div>
                </details>
                <details>
                    <summary>Misi√≥n 3: La Caja de Herramientas</summary>
                    <div class="activities-container">
                        <div class="activity-card">
                            <div><h3>T√©cnicas e Instrumentos</h3><p>Exploramos cu√°ndo y c√≥mo usar cada herramienta.</p></div>
                            <div class="resource-buttons"><a href="https://elmejorequipo.github.io/talleres/videoquiz.html" target="_blank" class="btn-resource btn-activity">Acceder al Recurso ‚Üó</a></div>
                             <div class="task-completion" data-task-id="task6">
                                <div class="lock-container"><input type="text" placeholder="C√≥digo de la Tarea"><button>Desbloquear</button></div>
                                <div class="task-checkbox-wrapper locked"><input type="checkbox" id="task6" class="task-checkbox" disabled><label for="task6">Marcar como completada</label></div>
                                <p class="task-feedback" style="color:#777;">Anota el c√≥digo del recurso para desbloquear.</p>
                            </div>
                        </div>
                        <div class="activity-card">
                            <div><h3>Infograf√≠a: El Camino Completo</h3><p>Un resumen visual de todo nuestro proceso de evaluaci√≥n.</p></div>
                            <div class="resource-buttons"><a href="https://elmejorequipo.github.io/talleres/infografia.html" target="_blank" class="btn-resource btn-activity">Acceder al Recurso ‚Üó</a></div>
                             <div class="task-completion" data-task-id="task7">
                                <div class="lock-container"><input type="text" placeholder="C√≥digo de la Tarea"><button>Desbloquear</button></div>
                                <div class="task-checkbox-wrapper locked"><input type="checkbox" id="task7" class="task-checkbox" disabled><label for="task7">Marcar como completada</label></div>
                                <p class="task-feedback" style="color:#777;">Anota el c√≥digo del recurso para desbloquear.</p>
                            </div>
                        </div>
                        <div class="activity-card">
                            <div><h3>Instrumentos en Acci√≥n</h3><p>Analizamos ejemplos y casos de uso de r√∫bricas y listas.</p></div>
                            <div class="resource-buttons">
                                <a href="https://soundcloud.com/el-mejor-equipo-282759177/mas-alla-de-la-nota?si=f2eaf0c20c244ac3b73f2b2218e379a6&utm_source=clipboard&utm_medium=text&utm_campaign=social_sharing" target="_blank" class="btn-resource btn-activity">üéß Escuchar Audio Explicativo ‚Üó</a>
                                <a href="https://g.co/gemini/share/84ca31f4a60b" target="_blank" class="btn-resource btn-activity">üìÑ Ver Gu√≠a de Instrumentos ‚Üó</a>
                            </div>
                             <div class="task-completion" data-task-id="task8">
                                <div class="lock-container"><input type="text" placeholder="C√≥digo de la Tarea"><button>Desbloquear</button></div>
                                <div class="task-checkbox-wrapper locked"><input type="checkbox" id="task8" class="task-checkbox" disabled><label for="task8">Marcar como completada</label></div>
                                <p class="task-feedback" style="color:#777;">Anota el c√≥digo del recurso para desbloquear.</p>
                            </div>
                        </div>
                    </div>
                </details>
                <details>
                    <summary>Misi√≥n 4: Sellar el Compromiso</summary>
                    <div class="activities-container">
                         <div class="activity-card">
                             <div><h3>Nuestro Muro del Compromiso</h3><p>Transforma la reflexi√≥n en acci√≥n y obt√©n tu certificado.</p></div>
                            <div class="commitment-form">
                                <div class="form-group"><label for="fullName">Nombre Completo:</label><input type="text" id="fullName" placeholder="TODO EN MAY√öSCULAS"></div>
                                <div class="form-group"><label for="level">Nivel:</label><select id="level"><option value="Inicial">Inicial</option><option value="Primaria">Primaria</option><option value="Secundaria">Secundaria</option></select></div>
                                <div class="form-group"><label for="course">Curso:</label><input type="text" id="course" placeholder="Ej: 6to de Primaria 'A'"></div>
                            </div>
                            <div class="task-completion" data-task-id="task9">
                               <div class="task-checkbox-wrapper locked"><input type="checkbox" id="task9" class="task-checkbox" disabled><label for="task9">He completado mi compromiso</label></div>
                               <p class="task-feedback" style="color:#777;">Esta tarea se habilitar√° al completar todo lo anterior.</p>
                            </div>
                        </div>
                    </div>
                </details>
            </div>
        </main>
    </div>

    <div class="ad-section">
        <h2>Contin√∫a tu Formaci√≥n</h2>
        <div class="ad-container">
            <div class="ad-card">
                <h3>Curso de Salvaguarda</h3>
                <p>Aprende a crear entornos seguros para nuestros j√≥venes. Inscr√≠bete en nuestros cursos de protecci√≥n y buen trato.</p>
                <a href="https://academia.dbeduca.org.bo/" target="_blank">M√°s Informaci√≥n</a>
            </div>
            <div class="ad-card">
                <h3>Asistente Pedag√≥gico IA</h3>
                <p>Descubre a tu nuevo aliado IA para la planificaci√≥n, creaci√≥n de materiales y evaluaci√≥n en el aula.</p>
                <a href="https://elmejorequipo.github.io/asistentepedagogicodb/index.html" target="_blank">Probar Ahora</a>
            </div>
        </div>
        <footer><p>Creado con el Asesor Pedag√≥gico Salesiano &copy; 2025</p></footer>
    </div>
    
    <div id="confirmation-modal" class="modal">
        <div class="modal-content">
            <h2>¬°Felicidades, has completado la jornada!</h2>
            <p>Por favor, confirma que tus datos para el certificado son correctos:</p>
            <div class="data-confirm">
                <p><strong>Nombre:</strong> <span id="confirm-name"></span></p>
                <p><strong>Nivel:</strong> <span id="confirm-level"></span></p>
                <p><strong>Curso:</strong> <span id="confirm-course"></span></p>
            </div>
            <div class="modal-buttons">
                <button id="edit-data-btn">Editar Datos</button>
                <button id="confirm-download-btn">Descargar Certificado</button>
            </div>
        </div>
    </div>
    
    <script>
    document.addEventListener('DOMContentLoaded', () => {

        const taskCodes = {
            task2: "82639",
            task3: "75391",
            task4: "88462",
            task5: "17593",
            task6: "44827",
            task7: "35790",
            task8: "62951"
        };
        
        const allCheckboxes = Array.from(document.querySelectorAll('.task-checkbox'));
        const finalTaskCheckbox = document.getElementById('task9');
        
        // --- L√≥gica del Modal de Bienvenida ---
        const welcomeModal = document.getElementById('welcome-modal');
        if (welcomeModal) {
            welcomeModal.classList.add('visible');
            const welcomeButton = document.getElementById('welcome-modal-btn');
            if (welcomeButton) {
                welcomeButton.addEventListener('click', () => {
                    welcomeModal.classList.remove('visible');
                });
            } else {
                console.error("Bot√≥n 'welcome-modal-btn' no encontrado en el HTML.");
            }
        }

        // --- L√≥gica de Progreso y Dependencias ---
        function checkDependencies() {
            const indicatorsCheckbox = document.getElementById('task5');
            const mission2Prereqs = [document.getElementById('task3'), document.getElementById('task4')];
            const mission2Met = mission2Prereqs.every(cb => cb.checked);
            const indicatorsWrapper = indicatorsCheckbox.closest('.task-checkbox-wrapper');
            
            if (mission2Met) {
                indicatorsCheckbox.disabled = false;
                indicatorsWrapper.classList.remove('locked');
            } else {
                indicatorsCheckbox.disabled = true;
                indicatorsWrapper.classList.add('locked');
            }

            const prerequisiteCheckboxes = allCheckboxes.filter(cb => cb.id !== 'task9');
            const allFinalPrereqsMet = prerequisiteCheckboxes.every(cb => cb.checked);
            const finalTaskWrapper = finalTaskCheckbox.closest('.task-checkbox-wrapper');
            
            if (allFinalPrereqsMet) {
                finalTaskCheckbox.disabled = false;
                finalTaskWrapper.classList.remove('locked');
            } else {
                finalTaskCheckbox.disabled = true;
                finalTaskWrapper.classList.add('locked');
            }
        }

        function updateProgress() {
            const checkedTasks = document.querySelectorAll('.task-checkbox:checked').length;
            const totalTasks = allCheckboxes.length;
            const percentage = totalTasks > 0 ? (checkedTasks / totalTasks) * 100 : 0;
            const progressBar = document.getElementById('progress-bar');
            const progressText = document.getElementById('progress-text');
            
            progressBar.style.width = percentage + '%';
            progressText.textContent = `Progreso del Taller: ${Math.round(percentage)}%`;

            if (percentage === 100) {
                progressText.textContent = '¬°Taller Completado!';
                progressBar.style.backgroundColor = 'var(--corr)';
            } else {
                progressBar.style.backgroundColor = 'var(--sec)';
            }
        }

        // --- Guardado y Carga de Estado ---
        function saveState() {
            const states = {};
            allCheckboxes.forEach(cb => {
                states[cb.id] = { checked: cb.checked, disabled: cb.disabled };
            });
            localStorage.setItem('tallerProgresoV9', JSON.stringify(states));
        }

        function loadState() {
            const savedStates = JSON.parse(localStorage.getItem('tallerProgresoV9'));
            if (savedStates) {
                allCheckboxes.forEach(cb => {
                    const state = savedStates[cb.id];
                    if (state) {
                        cb.checked = state.checked;
                        cb.disabled = state.disabled;
                        
                        const wrapper = cb.closest('.task-checkbox-wrapper');
                        const container = cb.closest('.task-completion');
                        const lockContainer = container.querySelector('.lock-container');

                        if (!cb.disabled) {
                            if (lockContainer) lockContainer.style.display = 'none';
                            if (wrapper) wrapper.classList.remove('locked');
                        }
                    }
                });
            }
            updateProgress();
            checkDependencies();
        }

        // --- Manejadores de Eventos ---
        document.querySelectorAll('.lock-container button').forEach(button => {
            button.addEventListener('click', () => {
                const container = button.closest('.task-completion');
                const taskId = container.dataset.taskId;
                const input = container.querySelector('input[type="text"]');
                const checkbox = document.getElementById(taskId);
                const feedbackP = container.querySelector('.task-feedback');

                if (input.value.trim() === taskCodes[taskId]) {
                    checkbox.disabled = false;
                    container.querySelector('.lock-container').style.display = 'none';
                    container.querySelector('.task-checkbox-wrapper').classList.remove('locked');
                    
                    feedbackP.textContent = '¬°C√≥digo correcto! Tarea desbloqueada.';
                    feedbackP.style.color = 'var(--corr)';
                    
                    saveState();
                } else {
                    feedbackP.textContent = 'C√≥digo incorrecto. ¬°Intenta de nuevo!';
                    feedbackP.style.color = 'var(--err)';
                    input.value = '';
                    input.focus();
                }
            });
        });

        allCheckboxes.forEach(cb => {
            cb.addEventListener('change', () => {
                updateProgress();
                checkDependencies();
                saveState();
                if (cb.id === 'task9' && cb.checked) {
                    triggerCertificateFlow();
                }
            });
        });

        // --- Flujo del Certificado ---
        function triggerCertificateFlow() {
            const fullName = document.getElementById('fullName').value.trim().toUpperCase();
            if (!fullName) {
                alert('Por favor, ingresa tu nombre completo para el certificado.');
                finalTaskCheckbox.checked = false;
                updateProgress();
                saveState();
                return;
            }
            
            const confirmModal = document.getElementById('confirmation-modal');
            document.getElementById('confirm-name').textContent = fullName;
            document.getElementById('confirm-level').textContent = document.getElementById('level').value;
            document.getElementById('confirm-course').textContent = document.getElementById('course').value;
            confirmModal.classList.add('visible');
        }

        document.getElementById('edit-data-btn').addEventListener('click', () => {
            document.getElementById('confirmation-modal').classList.remove('visible');
        });
        document.getElementById('confirm-download-btn').addEventListener('click', generateCertificate);

function generateCertificate() {
    const modal = document.getElementById('confirmation-modal');
    const modalContent = modal.querySelector('.modal-content');
    const originalModalHTML = modalContent.innerHTML;
    modalContent.innerHTML = '<h2>Generando tu certificado...</h2><p>Por favor, espera un momento.</p>';

    // --- MANT√âN TUS CADENAS BASE64 AQU√ç ---
    // ¬°RECUERDA USAR LA CADENA COMPLETA PARA TU LOGO PRINCIPAL!
    const logoPrincipalBase64 = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8/5+hHgAHggJ/PchI7wAAAABJRU5ErkJggg=='; // <-- ¬°REEMPLAZAR!
    const logoSelloBase64 = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAACiSURBVEhLY2RY8v9/BgaGgywDDADpGMDy/39GRgaG/weS4j8QAbwZGGYdCMUYGBgYGJri/wcGBob////fM4wPjP+Yw/j/L8P/D4ap8//vQ0//f+r7/+s/x//v/x//v//fIisDEwMDw3/G/8+A4gEwGDAwMAxV/H8wywD+Z2BgYHgJ8B8wMDAwMDAwMEz4/4GBgeE/w08DAwMDAwMDw48BAgwAsrQhAtC4H3AAAAAASUVORK5CYII=';

    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF({ orientation: 'landscape', unit: 'px', format: [800, 565] });

    try {
        pdf.setFillColor(244, 247, 250);
        pdf.rect(0, 0, 800, 565, 'F');
        pdf.setDrawColor(0, 90, 156);
        pdf.setLineWidth(20);
        pdf.rect(0, 0, 800, 565);

        // --- Ajustes para Logo Principal (Izquierda, sin distorsi√≥n) ---
        const logoPrincipalImg = new Image();
        logoPrincipalImg.src = logoPrincipalBase64;
        if (logoPrincipalImg.width > 0) {
            const originalWidth = logoPrincipalImg.width;
            const originalHeight = logoPrincipalImg.height;
            const desiredHeight = 60; // Altura fija
            const aspectRatio = originalWidth / originalHeight;
            const desiredWidth = desiredHeight * aspectRatio; // Ancho calculado
            pdf.addImage(logoPrincipalBase64, 'PNG', 40, 40, desiredWidth, desiredHeight, 'logoPrincipal', 'FAST');
        }

        // --- Ajustes para Logo del Sello (Derecha) ---
        const logoSelloWidth = 70;
        const logoSelloHeight = 70;
        const marginRight = 40;
        const xPositionSello = 800 - logoSelloWidth - marginRight;
        pdf.addImage(logoSelloBase64, 'PNG', xPositionSello, 40, logoSelloWidth, logoSelloHeight, 'logoSello', 'FAST');

        // --- Contenido del Certificado (Ajustado verticalmente) ---
        const verticalOffset = 20; // Espacio extra para bajar el texto
        
        pdf.setFont('Poppins', 'bold');
        pdf.setTextColor(0, 90, 156);
        pdf.setFontSize(40);
        pdf.text('Certificado de Participaci√≥n', 400, 120 + verticalOffset, { align: 'center' });

        pdf.setFont('Poppins', 'normal');
        pdf.setTextColor(51, 51, 51);
        pdf.setFontSize(18);
        pdf.text('Otorgado a:', 400, 170 + verticalOffset, { align: 'center' });

        pdf.setFont('Poppins', 'bold');
        pdf.setTextColor(0, 90, 156);
        pdf.setFontSize(36);
        pdf.text(document.getElementById('fullName').value.trim().toUpperCase(), 400, 230 + verticalOffset, { align: 'center' });
        
        pdf.setDrawColor(255, 199, 44);
        pdf.setLineWidth(2);
        pdf.line(200, 245 + verticalOffset, 600, 245 + verticalOffset);

        pdf.setFont('Poppins', 'normal');
        pdf.setTextColor(51, 51, 51);
        pdf.setFontSize(16);
        const longText = `Por haber completado con √©xito la Jornada de Formaci√≥n Salesiana: "De la Visi√≥n a la Evidencia", demostrando un firme compromiso con la excelencia y la rigurosidad en la evaluaci√≥n, pilares del carisma de Don Bosco.`;
        pdf.text(longText, 400, 300 + verticalOffset, { align: 'center', maxWidth: 600 });
        
        pdf.setFont('Poppins', 'italic');
        pdf.setFontSize(14);
        pdf.text('"Una educaci√≥n sin afecto es como un cuerpo sin alma." - Don Bosco', 400, 370 + verticalOffset, { align: 'center' });
        
        pdf.setDrawColor(51, 51, 51);
        pdf.setLineWidth(1);
        pdf.line(300, 480, 500, 480);
        pdf.setFontSize(12);
        pdf.text('Direcci√≥n de Nivel', 400, 500, { align: 'center' });

        // Usamos la fecha actual de Bolivia al momento de la generaci√≥n
        const currentDate = new Date().toLocaleDateString('es-BO', { day: '2-digit', month: 'long', year: 'numeric' });
        pdf.setFontSize(10);
        pdf.text(`Lugar y Fecha: Santa Cruz de la Sierra, ${currentDate}`, 400, 525, { align: 'center' });
        pdf.text('Duraci√≥n: 8 horas acad√©micas', 400, 540, { align: 'center' });
        
        pdf.save(`Certificado_${document.getElementById('fullName').value.trim()}.pdf`);

    } catch (e) {
        console.error("Error al generar el PDF:", e);
        alert("Hubo un error al generar el certificado. Es posible que una de las im√°genes no se haya podido cargar.");
    } finally {
        // Restaurar el modal a su estado original despu√©s de 1 segundo
        setTimeout(() => {
            modalContent.innerHTML = originalModalHTML;
            modal.classList.remove('visible');
            // Volver a a√±adir los listeners para que funcione si se intenta descargar de nuevo
            document.getElementById('edit-data-btn').addEventListener('click', () => { modal.classList.remove('visible'); });
            document.getElementById('confirm-download-btn').addEventListener('click', generateCertificate);
        }, 1000);
    }
}
        
        loadState();
    });
</script>
</body>
</html>
